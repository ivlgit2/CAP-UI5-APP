const _4sqlite = global.cds && global.cds.env.i18n ? global.cds.env.i18n.for_sqlite || [] : []
const localized = []
_4sqlite.forEach(lang => {
  localized.push(`localized.${lang}`)
  localized.push(`localized_${lang}`)
})
localized.push('localized')

const ensureUnlocalized = table => {
  const localizedPrefix = localized.find(element => {
    return table.startsWith(element)
  })
  return localizedPrefix ? table.substring(localizedPrefix.length + 1) : table
}

const ensureDraftsSuffix = name => {
  if (name.endsWith('_drafts')) {
    return name
  }

  return `${ensureUnlocalized(name)}_drafts`
}

const ensureNoDraftsSuffix = name => (name.endsWith('_drafts') ? name.slice(0, -7) : name)

module.exports = {
  ensureDraftsSuffix,
  ensureNoDraftsSuffix,
  ensureUnlocalized
}
