'use strict';
const { forEachDefinition, forEachMemberRecursively } = require('../../model/csnUtils');
const enrich = require('./enricher');

/**
 * Run the given validations for each artifact and for each member recursively
 *
 * @param {CSN.Model} csn CSN to check
 * @param {object} that Will be provided to the validators via "this"
 * @param {Function[]} [memberValidators=[]] Validations on member-level
 * @param {Function[]} [artifactValidators=[]] Validations on artifact-level
 */
function validate(csn, that, memberValidators=[], artifactValidators=[]){
  enrich(csn);

  forEachDefinition(csn, (artifact, artifactName, prop, path) => {
    artifactValidators.forEach(artifactValidator => artifactValidator.bind(that)(artifact, artifactName, prop, path));
    forEachMemberRecursively(artifact,(member, memberName, prop, path) => {
      memberValidators.forEach(memberValidator => memberValidator.bind(that)(member, memberName, prop, path));
    } , ['definitions', artifactName])
  });
}

module.exports = validate;
